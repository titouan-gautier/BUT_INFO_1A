select * from basetd.distribution;
select * from basetd.commune;
select * from basetd.operateur;
select * from basetd.departement

--- Question 1 ---
select co.nom_commune
    from basetd.commune co
        where co.nomdep in (select de.nomdep from basetd.departement de where de.code_departement = 49);

select co.nom_commune
    from basetd.commune co
        where exists (select * from basetd.departement de where de.code_departement = 49 and co.nomdep = de.nomdep);

--- Question 2 ---
select distinct co.nom_commune, co.nomdep
    from basetd.commune co, basetd.operateur op
        where op.generation = '5G'
        and (op.numfo,co.code_insee) in (select di.numfo,di.code_insee from basetd.distribution di);

select distinct co.nom_commune, co.nomdep 
    from basetd.commune co, basetd.operateur op
        where op.generation = '5G'
        and exists (select * from basetd.distribution di
            where op.numfo = di.numfo
            and co.code_insee = di.code_insee);

--- Question 3 ---
select distinct co.nom_commune, co.nomdep
    from basetd.commune co
        where co.code_insee not in (select distinct di.code_insee from basetd.distribution di, basetd.operateur op
            where op.numfo = di.numfo
            and op.generation = '5G')
            order by co.nom_commune;
            
select distinct co.nom_commune, co.nomdep
    from basetd.commune co
        where not exists (select * from basetd.distribution di, basetd.operateur op
            where op.generation = '5G'
            and op.numfo = di.numfo
            and co.code_insee = di.code_insee)
                order by co.nom_commune;
                
--- Question 4 ---
select distinct co.nom_commune, co.nomdep , de.code_departement
    from basetd.commune co, basetd.departement de
        where co.code_insee not in (select distinct di.code_insee from basetd.distribution di, basetd.operateur op
            where op.numfo = di.numfo
            and op.generation = '5G')
            and co.nomdep = de.nomdep
            and de.code_departement = '44'
            order by co.nom_commune;
            
select distinct co.nom_commune, co.nomdep , de.code_departement
    from basetd.commune co, basetd.departement de
        where not exists (select * from basetd.distribution di, basetd.operateur op
            where op.generation = '5G'
            and op.numfo = di.numfo
            and co.code_insee = di.code_insee)
            and de.nomdep = co.nomdep
            and de.code_departement = '44'
                order by co.nom_commune;
                
--- Question 5 ---
select co.nomdep, count(*)
    from basetd.commune co, basetd.departement de
        where co.nomdep = de.nomdep
            group by co.nomdep
                order by 1;
                
select de.nomdep ,(select count(*) from basetd.commune co where co.nomdep = de.nomdep)
    from basetd.departement de;
    
--- Question 6 ---
select co.nom_commune, count(*)select  co.nom_commune, (select count(*)
                            from basetd.distribution di, basetd.operateur op
                                where co.code_insee = di.code_insee
                                and di.numfo = op.numfo
                                and op.generation = '5G')cinqG,
                        (select count(*)
                            from basetd.distribution di, basetd.operateur op
                                where co.code_insee = di.code_insee
                                    and di.numfo = op.numfo
                                    and op.generation = '4G')quatreG
    from basetd.commune co
            where co.nomdep = 'Loire-Atlantique'
                order by 2 desc , 3 desc ;
    from basetd.commune co, basetd.distribution di, basetd.operateur op , basetd.departement de
        where op.generation = '5G'
        and co.code_insee = di.code_insee
        and op.numfo = di.numfo
        and co.nomdep = de.nomdep
        and de.code_departement = '44'
            group by co.nom_commune
                order by 2;
                
select co.nom_commune, (select count(*) c from basetd.distribution di, basetd.operateur op , basetd.departement de 
                            where co.code_insee = di.code_insee
                            and op.numfo = di.numfo
                            and co.nomdep = de.nomdep
                            and op.generation = '5G'
                            and de.code_departement = '44'
                                having count(*) > 0) nb
    from basetd.commune co
        order by 2;

--- Question 7 ---
select co.nom_commune, count(*)
    from basetd.commune co, basetd.distribution di, basetd.operateur op , basetd.departement de
        where op.generation = '5G'
        and co.code_insee = di.code_insee
        and op.numfo = di.numfo
        and co.nomdep = de.nomdep
        and de.code_departement = '44'
            having count(*) >= 10
                group by co.nom_commune
                    order by 2;

select co.nom_commune, (select count(*) c from basetd.distribution di, basetd.operateur op , basetd.departement de
                            where co.code_insee = di.code_insee
                            and op.numfo = di.numfo
                            and co.nomdep = de.nomdep
                            and op.generation = '5G'
                            and de.code_departement = '44'
                                having count(*) >= 10) nb
    from basetd.commune co
        order by 2;
        
--- Question 8 ---
select co.nom_commune, count(*)
    from basetd.commune co , basetd.departement de , basetd.operateur op , basetd.distribution di
        where co.nomdep = de.nomdep
        and di.numfo = op.numfo
        and co.code_insee = di.code_insee
        and op.generation = '4G'
        and de.code_departement = '44'
            group by co.nom_commune
                order by 2 desc;
                
select co.nom_commune, count(*)
    from basetd.commune co , basetd.departement de , basetd.operateur op , basetd.distribution di
        where co.nomdep = de.nomdep
        and di.numfo = op.numfo
        and co.code_insee = di.code_insee
        and op.generation = '5G'
        and de.code_departement = '44'
            group by co.nom_commune
                order by 2 desc;
    
select  co.nom_commune, (select count(*)
                            from basetd.distribution di, basetd.operateur op
                                where co.code_insee = di.code_insee
                                and di.numfo = op.numfo
                                and op.generation = '5G')cinqG, 
                        (select count(*)
                            from basetd.distribution di, basetd.operateur op
                                where co.code_insee = di.code_insee
                                    and di.numfo = op.numfo
                                    and op.generation = '4G')quatreG
    from basetd.commune co
            where co.nomdep = 'Loire-Atlantique'
                order by 2 desc , 3 desc ;

--- Question 9 ---

select op.nomfo , op.technologie, count(*)
    from BASETD.commune co , BASETD.operateur op, BASETD.distribution di
        where op.technologie in('5G NR 3500','5G NR 2100','5G NR 700')
        and op.numfo = di.numfo
        and co.code_insee = di.code_insee
            group by op.nomfo , op.technologie
                order by 2;

select op.nomfo, op.technologie ,(select count(*)
                from BASETD.commune co , BASETD.distribution di
                    where op.numfo = di.numfo
                    and co.code_insee = di.code_insee)
    from basetd.operateur op
        where op.technologie in('5G NR 3500','5G NR 2100','5G NR 700')
            order by 3 desc;
--- Queqtion 10 ---
select co.nom_commune , op.technologie, count(*)
    from BASETD.commune co , BASETD.operateur op, BASETD.distribution di
        where op.technologie in('5G NR 3500','5G NR 2100','5G NR 700')
        and op.numfo = di.numfo
        and co.code_insee = di.code_insee
        and co.nom_commune = 'Nantes'
            group by co.nom_commune , op.technologie
                order by 2;

select op.nomfo, op.technologie ,(select count(*)
                from BASETD.commune co , BASETD.distribution di
                    where op.numfo = di.numfo
                    and co.code_insee = di.code_insee
                    and co.nom_commune = 'Nantes' )
    from basetd.operateur op
        where op.technologie in('5G NR 3500','5G NR 2100','5G NR 700')
            order by 3 desc;

--- Question 11 ---


select co.nomdep , op.technologie, count(*)
    from BASETD.commune co , BASETD.operateur op, BASETD.distribution di
        where op.technologie in('5G NR 3500','5G NR 2100','5G NR 700')
        and op.numfo = di.numfo
        and co.code_insee = di.code_insee
        and co.nomdep = 'Loire-Atlantique'
            group by co.nomdep , op.technologie
                order by 2;
select op.nomfo, op.technologie, (select count(*)
								    from basetd.commune co, basetd.distribution di
									    where op.numfo = di.numfo
										and co.code_insee = di.code_insee
										and co.nomdep = 'Loire-Atlantique')Count
    from basetd.operateur op
				where op.technologie in ('5G NR 3500','5G NR 2100','5G NR 700')
				    order by 3 desc;


--- Question 12 ---

select co.nom_commune
    from BASETD.commune co
        where co.code_insee not in (select co.code_insee from BASETD.commune co, BASETD.operateur op
                                    where (co.code_insee, op.numfo) not in
                                    (select di.code_insee, di.numfo
                                        from basetd.distribution di));
select co.nom_commune
    from BASETD.commune co
        where not exists (select * from BASETD.commune coo, BASETD.operateur op
                                    where coo.nom_commune = co.nom_commune
                                    and not exists (select *
                                                        from basetd.distribution di
                                                            where co.code_insee = di.code_insee
                                                            and op.numfo = di.numfo));

--- Question 13 ---
select co.nom_commune
    from BASETD.commune co
        where not exists (select * from BASETD.commune coo, BASETD.operateur op
                                    where coo.nom_commune = co.nom_commune
                                    and op.generation = '5G'
                                    and not exists (select *
                                                        from basetd.distribution di
                                                            where co.code_insee = di.code_insee
                                                            and op.numfo = di.numfo));

--- Question 14 ---

select co.nom_commune
    from BASETD.commune co
        where not exists (select * from BASETD.commune coo, BASETD.operateur op
                                    where coo.nom_commune = co.nom_commune
                                    and op.generation = '4G'
                                    and op.nomfo = 'ORANGE'
                                    and not exists (select *
                                                        from basetd.distribution di
                                                            where co.code_insee = di.code_insee
                                                            and op.numfo = di.numfo));