select * from basetd.distribution;
select * from basetd.commune;
select * from basetd.operateur;
select * from basetd.departement


select co.nom_commune
    from basetd.commune co
        where co.nomdep in (select de.nomdep from basetd.departement de where de.code_departement = 49);

select co.nom_commune
    from basetd.commune co
        where exists (select * from basetd.departement de where de.code_departement = 49 and co.nomdep = de.nomdep);


select distinct co.nom_commune, co.nomdep
    from basetd.commune co, basetd.operateur op
        where op.generation = '5G'
        and (op.numfo,co.code_insee) in (select di.numfo,di.code_insee from basetd.distribution di);

select distinct co.nom_commune, co.nomdep 
    from basetd.commune co, basetd.operateur op
        where op.generation = '5G'
        and exists (select * from basetd.distribution di
            where op.numfo = di.numfo
            and co.code_insee = di.code_insee);


select distinct co.nom_commune, co.nomdep
    from basetd.commune co
        where co.code_insee not in (select distinct di.code_insee from basetd.distribution di, basetd.operateur op
            where op.numfo = di.numfo
            and op.generation = '5G')
            order by co.nom_commune;
            
select distinct co.nom_commune, co.nomdep
    from basetd.commune co
        where not exists (select * from basetd.distribution di, basetd.operateur op
            where op.generation = '5G'
            and op.numfo = di.numfo
            and co.code_insee = di.code_insee)
                order by co.nom_commune;
                

select distinct co.nom_commune, co.nomdep , de.code_departement
    from basetd.commune co, basetd.departement de
        where co.code_insee not in (select distinct di.code_insee from basetd.distribution di, basetd.operateur op
            where op.numfo = di.numfo
            and op.generation = '5G')
            and co.nomdep = de.nomdep
            and de.code_departement = '44'
            order by co.nom_commune;
            
select distinct co.nom_commune, co.nomdep , de.code_departement
    from basetd.commune co, basetd.departement de
        where not exists (select * from basetd.distribution di, basetd.operateur op
            where op.generation = '5G'
            and op.numfo = di.numfo
            and co.code_insee = di.code_insee)
            and de.nomdep = co.nomdep
            and de.code_departement = '44'
                order by co.nom_commune;
                

select co.nomdep, count(*)
    from basetd.commune co, basetd.departement de
        where co.nomdep = de.nomdep
            group by co.nomdep
                order by 1;
                
select de.nomdep ,(select count(*) from basetd.commune co where co.nomdep = de.nomdep)
    from basetd.departement de;
    

select co.nom_commune, count(*)
    from basetd.commune co, basetd.distribution di, basetd.operateur op , basetd.departement de
        where op.generation = '5G'
        and co.code_insee = di.code_insee
        and op.numfo = di.numfo
        and co.nomdep = de.nomdep
        and de.code_departement = '44'
            group by co.nom_commune
                order by 2;
                
select co.nom_commune, (select count(*) c from basetd.distribution di, basetd.operateur op , basetd.departement de 
                            where co.code_insee = di.code_insee
                            and op.numfo = di.numfo
                            and co.nomdep = de.nomdep
                            and op.generation = '5G'
                            and de.code_departement = '44'
                                having count(*) > 0) nb
    from basetd.commune co
        order by 2;


select co.nom_commune, count(*)
    from basetd.commune co, basetd.distribution di, basetd.operateur op , basetd.departement de
        where op.generation = '5G'
        and co.code_insee = di.code_insee
        and op.numfo = di.numfo
        and co.nomdep = de.nomdep
        and de.code_departement = '44'
            having count(*) >= 10
                group by co.nom_commune
                    order by 2;

select co.nom_commune, (select count(*) c from basetd.distribution di, basetd.operateur op , basetd.departement de 
                            where co.code_insee = di.code_insee
                            and op.numfo = di.numfo
                            and co.nomdep = de.nomdep
                            and op.generation = '5G'
                            and de.code_departement = '44'
                                having count(*) >= 10) nb
    from basetd.commune co
        order by 2;
        

select co.nom_commune, count(*)
    from basetd.commune co , basetd.departement de , basetd.operateur op , basetd.distribution di
        where co.nomdep = de.nomdep
        and di.numfo = op.numfo
        and co.code_insee = di.code_insee
        and op.generation = '4G'
        and de.code_departement = '44'
            group by co.nom_commune
                order by 2 desc;
                
select co.nom_commune, count(*)
    from basetd.commune co , basetd.departement de , basetd.operateur op , basetd.distribution di
        where co.nomdep = de.nomdep
        and di.numfo = op.numfo
        and co.code_insee = di.code_insee
        and op.generation = '5G'
        and de.code_departement = '44'
            group by co.nom_commune
                order by 2 desc;
    
select  co.nom_commune, (select count(*)
                            from basetd.distribution di, basetd.operateur op
                                where co.code_insee = di.code_insee
                                and di.numfo = op.numfo
                                and op.generation = '5G')cinqG, 
                        (select count(*)
                            from basetd.distribution di, basetd.operateur op
                                where co.code_insee = di.code_insee
                                    and di.numfo = op.numfo
                                    and op.generation = '4G')quatreG
    from basetd.commune co
            where co.nomdep = 'Loire-Atlantique'
                order by 2 desc , 3 desc ;